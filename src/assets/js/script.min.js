let isUpdate=!1,updateId;const url=window.location.href,lang=localStorage.getItem("lang"),notesContainer=document.querySelector("main"),popupBox=document.querySelector(".popup-box"),connectBox=document.querySelector(".connect-box"),creerBox=document.querySelector(".creer-box"),couleurTag=popupBox.querySelector("#couleur"),titleTag=popupBox.querySelector("#title"),descTag=popupBox.querySelector("#content"),notes=JSON.parse(localStorage.getItem("local_notes")||"[]");"https://leoseguin.fr/projets/notes/en.php"==url&&null==lang&&localStorage.setItem("lang","en"),"https://leoseguin.fr/projets/notes/"==url&&null==lang&&localStorage.setItem("lang","fr"),"https://leoseguin.fr/projets/notes/en.php"==url&&"fr"==lang&&window.open("./","_self"),"https://leoseguin.fr/projets/notes/"==url&&"en"==lang&&window.open("./en.php","_self");const showNotes=async()=>{notes&&(document.querySelectorAll(".note").forEach(e=>e.remove()),notes.sort((e,t)=>new Date(t.date)-new Date(e.date)).forEach((e,t)=>{let r=e.couleur,n=e.title.replaceAll("<br /><br />","\n\n").replaceAll("<br />","\n"),l=e.description.replaceAll("<br /><br />","\n\n").replaceAll("<br />","\n"),o=new showdown.Converter({tasklists:!0,smoothLivePreview:!0,extensions:[taskListEnablerExtension]}),s=document.createElement("div");s.setAttribute("id","note"+t),s.classList.add("note",r);let a=document.createElement("div");a.classList.add("details");let c=document.createElement("p");c.classList.add("title"),c.textContent=n;let i=document.createElement("span");i.innerHTML=o.makeHtml(l).replaceAll("\n\n","<br /><br />").replaceAll("\n","<br />"),a.appendChild(c),a.appendChild(i),s.appendChild(a);let d=document.createElement("div");d.classList.add("bottom-content");let u=document.createElement("i");u.classList.add("fa-solid","fa-calendar-days"),u.setAttribute("title","Date (GMT)");let p=document.createElement("span");p.textContent=e.date;let f=document.createElement("i");f.classList.add("fa-solid","fa-pen"),f.onclick=()=>{updateNote(t,n,l.replaceAll("\n\n","<br /><br />").replaceAll("\n","<br />"),r)};let m=document.createElement("i");m.classList.add("fa-solid","fa-clipboard"),m.onclick=()=>{copy(l.replaceAll("\n\n","<br /><br />").replaceAll("\n","<br />"))};let y=document.createElement("i");y.classList.add("fa-solid","fa-trash-can"),y.onclick=()=>{deleteNote(t)};let h=document.createElement("i");h.classList.add("fa-solid","fa-expand"),h.onclick=()=>{toggleFullscreen(t)},d.appendChild(u),d.appendChild(p),d.appendChild(f),d.appendChild(m),d.appendChild(y),d.appendChild(h),s.appendChild(d),notesContainer.appendChild(s)}))};function toggleFullscreen(e){let t=document.querySelector("#note"+e),r=document.querySelector(".darken");t.classList.toggle("fullscreen"),r.classList.toggle("show")}function updateNote(e,t,r,n){let l=document.querySelectorAll(".note");l.forEach(e=>{e.classList.remove("fullscreen")}),document.querySelector(".darken").classList.remove("show");let o=r.replaceAll("<br /><br />","\n\n").replaceAll("<br />","\n");updateId=e,isUpdate=!0,document.querySelector(".icon").click(),couleurTag.value=n,titleTag.value=t,descTag.value=o}function taskListEnablerExtension(){return[{type:"output",regex:/<input type="checkbox"?/g,replace:'<input type="checkbox"'}]}function copy(e){let t=e.replaceAll("<br /><br />","\n\n").replaceAll("<br />","\n");navigator.clipboard.writeText(t);let r=document.getElementById("copyNotification");r.classList.add("show"),setTimeout(function(){r.classList.remove("show")},2e3)}function deleteNote(e){if("fr"===localStorage.getItem("lang")){if(confirm("Voulez-vous vraiment supprimer cette note ?")){notes.splice(e,1),localStorage.setItem("local_notes",JSON.stringify(notes)),document.querySelector(".darken").classList.remove("show"),showNotes();return}}else if(confirm("Do you really want to delete this note?")){notes.splice(e,1),localStorage.setItem("local_notes",JSON.stringify(notes)),document.querySelector(".darken").classList.remove("show"),showNotes();return}}document.querySelectorAll(".seconnecter").forEach(e=>{e.addEventListener("click",()=>{connectBox.classList.add("show"),document.querySelector("#nomConnect").focus()}),e.addEventListener("keydown",e=>{"Enter"===e.key&&(connectBox.classList.add("show"),document.querySelector("#nomConnect").focus())})}),document.querySelectorAll(".creercompte").forEach(e=>{e.addEventListener("click",()=>{connectBox.classList.remove("show"),creerBox.classList.add("show"),document.querySelector("#nomCreer").focus()}),e.addEventListener("keydown",e=>{"Enter"===e.key&&(connectBox.classList.remove("show"),creerBox.classList.add("show"),document.querySelector("#nomCreer").focus())})}),document.querySelector("#submitCreer").addEventListener("click",async()=>{let e=document.querySelector("#nomCreer").value.trim(),t=document.querySelector("#mdpCreer").value,r=document.querySelector("#mdpCreerValid").value;if(!e||!t||!r)return;if(!/^[a-zA-ZÀ-ÿ -]+$/.test(e)){if("fr"===localStorage.getItem("lang")){alert("Le nom ne peut contenir que des lettres...");return}alert("The name can only contain letters...");return}if(e.length<4){if("fr"===localStorage.getItem("lang")){alert("Nom trop court (<4)...");return}alert("Name too short (<4)...");return}if(t.length<6){if("fr"===localStorage.getItem("lang")){alert("Mot de passe trop faible (<6)...");return}alert("Password too weak (<6)...");return}if(/^[0-9]+$/.test(t)){if("fr"===localStorage.getItem("lang")){alert("Le mot de passe ne peut pas contenir que des chiffres...");return}alert("Password too weak (only numbers)...");return}if(/^[a-zA-Z]+$/.test(t)){if("fr"===localStorage.getItem("lang")){alert("Le mot de passe ne peut pas contenir que des lettres...");return}alert("Password too weak (only letters)...");return}if(t!==r){if("fr"===localStorage.getItem("lang")){alert("Les mots de passe ne correspondent pas...");return}alert("Passwords do not match...");return}if(e===t){if("fr"===localStorage.getItem("lang")){alert("Le mot de passe doit \xeatre diff\xe9rent du nom...");return}alert("The password must be different from the username...");return}let n=encodeURIComponent(e),l=encodeURIComponent(t);try{let o=await fetch("./assets/php/formCreer.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"nomCreer="+n+"&mdpCreer="+l+"&csrf_token_creer="+document.getElementById("csrf_token_creer").value});if(o.ok){"fr"===localStorage.getItem("lang")?alert("Compte cr\xe9\xe9 ! Veuillez vous connecter."):alert("Account created! Please log in."),creerBox.classList.remove("show"),document.querySelectorAll("form").forEach(e=>e.reset());return}if("fr"===localStorage.getItem("lang")){alert("Utilisateur d\xe9j\xe0 existant...");return}alert("User already exists...");return}catch(s){if("fr"===localStorage.getItem("lang")){alert("Une erreur est survenue lors de la cr\xe9ation du compte...");return}alert("An error occurred while creating the account...");return}}),document.querySelector("#submitSeConnecter").addEventListener("click",async()=>{let e=document.querySelector("#nomConnect").value.trim(),t=document.querySelector("#mdpConnect").value;if(!e||!t)return;if(!/^[a-zA-ZÀ-ÿ -]+$/.test(e)){if("fr"===localStorage.getItem("lang")){alert("Le nom ne peut contenir que des lettres...");return}alert("The name can only contain letters...");return}let r=encodeURIComponent(e),n=encodeURIComponent(t);fetch("./assets/php/formConnect.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"nomConnect="+r+"&mdpConnect="+n+"&csrf_token_connect="+document.getElementById("csrf_token_connect").value}).then(e=>{if(200===e.status)location.reload();else{if("fr"===localStorage.getItem("lang")){alert("Mauvais identifiants..."),document.querySelector("#mdpConnect").value="";let t=document.querySelector("#submitSeConnecter");t.disabled=!0;let r=10;t.textContent=`Se connecter (${r})`;let n=setInterval(()=>{r--,t.textContent=`Se connecter (${r})`},1e3);setTimeout(()=>{clearInterval(n),t.disabled=!1,t.textContent="Se connecter"},11e3);return}{alert("Wrong credentials..."),document.querySelector("#mdpConnect").value="";let l=document.querySelector("#submitSeConnecter");l.disabled=!0;let o=10;l.textContent=`Sign in (${o})`;let s=setInterval(()=>{o--,l.textContent=`Sign in (${o})`},1e3);setTimeout(()=>{clearInterval(s),l.disabled=!1,l.textContent="Sign in"},11e3);return}}})}),document.querySelectorAll(".icon").forEach(e=>{e.addEventListener("click",()=>{popupBox.classList.add("show"),document.querySelector("#title").focus()}),e.addEventListener("keydown",e=>{"Enter"===e.key&&(popupBox.classList.add("show"),document.querySelector("#title").focus())})}),document.querySelector("#submitNote").addEventListener("click",()=>{let e=couleurTag.value,t=titleTag.value.replaceAll(/'/g,"‘").replaceAll(/\\/g,"/").replaceAll(/"/g,"‘‘"),r=descTag.value.replaceAll(/'/g,"‘").replaceAll(/\\/g,"/").replaceAll(/"/g,"‘‘");if(!t||!r||r.length>2e3)return;let n={couleur:e,title:t,description:r,date:new Date().toISOString().slice(0,19).replace("T"," ")};isUpdate?(isUpdate=!1,notes[updateId]=n):notes.push(n),localStorage.setItem("local_notes",JSON.stringify(notes)),document.querySelectorAll("form").forEach(e=>e.reset()),showNotes(),popupBox.classList.remove("show")}),document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",e=>{e.preventDefault()})}),document.querySelectorAll("header i").forEach(e=>{e.addEventListener("click",()=>{isUpdate=!1,document.querySelectorAll("form").forEach(e=>e.reset()),popupBox.classList.remove("show"),connectBox.classList.remove("show"),creerBox.classList.remove("show"),document.querySelector(".darken").classList.remove("show")}),e.addEventListener("keydown",e=>{"Enter"===e.key&&(isUpdate=!1,document.querySelectorAll("form").forEach(e=>e.reset()),popupBox.classList.remove("show"),connectBox.classList.remove("show"),creerBox.classList.remove("show"),document.querySelector(".darken").classList.remove("show"))})}),document.querySelector("#search-input").addEventListener("keyup",()=>{let e=document.querySelector("#search-input").value.trim().toLowerCase();document.querySelectorAll(".note").forEach(t=>{let r=t.querySelector(".note p").innerText.toLowerCase();r.includes(e)?t.style.display="flex":t.style.display="none"})}),document.addEventListener("keydown",e=>{e.ctrlKey&&"k"===e.key&&(e.preventDefault(),document.querySelector("#search-input").focus())}),document.querySelector(".lang").addEventListener("click",()=>{if("en"===localStorage.getItem("lang")){localStorage.setItem("lang","fr"),window.open("./","_self");return}localStorage.setItem("lang","en"),window.open("./en.php","_self")}),document.querySelector(".lang").addEventListener("keydown",e=>{if("Enter"===e.key){if("en"===localStorage.getItem("lang")){localStorage.setItem("lang","fr"),window.open("./","_self");return}localStorage.setItem("lang","en"),window.open("./en.php","_self");return}}),document.addEventListener("DOMContentLoaded",()=>{showNotes(),"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js")});
