const url=window.location.href;"https://leoseguin.fr/projets/notes/en.php"==url&&null==localStorage.getItem("lang")&&localStorage.setItem("lang","en"),"https://leoseguin.fr/projets/notes/"==url&&null==localStorage.getItem("lang")&&localStorage.setItem("lang","fr"),"https://leoseguin.fr/projets/notes/en.php"==url&&"fr"==localStorage.getItem("lang")&&window.open("./","_self"),"https://leoseguin.fr/projets/notes/"==url&&"en"==localStorage.getItem("lang")&&window.open("./en.php","_self");const notesContainer=document.querySelector("main"),popupBoxConnect=document.querySelector(".connect-popup-box"),popupBoxGestion=document.querySelector(".gestion-popup-box"),couleurTagConnect=popupBoxConnect.querySelector("#couleurConnect"),titleTagConnect=popupBoxConnect.querySelector("#titleConnect"),descTagConnect=popupBoxConnect.querySelector("textarea");let isUpdate=!1,updateId;function showNotesConnect(){fetch("assets/php/getNotes.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>e.json()).then(e=>{e.forEach(e=>{let{id:t,title:r,couleur:o,desc:n,date:l,hidden:s}=e,a=r.replaceAll("<br /><br />","\n\n").replaceAll("<br />","\n"),c=n.replaceAll("<br /><br />","\n\n").replaceAll("<br />","\n"),i=()=>[{type:"output",regex:/<input type="checkbox"?/g,replace:'<input type="checkbox"'}],u=new showdown.Converter({tasklists:!0,smoothLivePreview:!0,extensions:[i]}),d;d=0==s?`<div id="note${t}" class="note ${o}"><div class="details"><p class="title">${a}</p><span>${u.makeHtml(c).replaceAll("\n\n","<br /><br />").replaceAll("\n","<br />")}</span></div><div class="bottom-content"><i title="Date (GMT)" class="fa-solid fa-calendar-days"></i><span>${l}</span><i class="fa-solid fa-pen" onclick="updateNoteConnect(${t},'${a}','${c.replaceAll("\n\n","<br /><br />").replaceAll("\n","<br />")}','${o}','${s}')"></i><i class="fa-solid fa-clipboard" onclick="copy('${c.replaceAll("\n\n","<br /><br />").replaceAll("\n","<br />")}')"></i><i class="fa-solid fa-trash-can" onclick="deleteNoteConnect(${t})"></i><i class="fa-solid fa-expand" onclick="toggleFullscreen(${t})"></i></div></div>`:`<div id="note${t}" class="note ${o}"><div class="details"><p class="title">${a}</p><span>******</span></div><div class="bottom-content"><i title="Date (GMT)" class="fa-solid fa-calendar-days"></i><span>${l}</span><i class="fa-solid fa-pen" onclick="updateNoteConnect(${t},'${a}','${c.replaceAll("\n\n","<br /><br />").replaceAll("\n","<br />")}','${o}','${s}')"></i><i class="fa-solid fa-clipboard" onclick="copy('${c.replaceAll("\n\n","<br /><br />").replaceAll("\n","<br />")}')"></i><i class="fa-solid fa-trash-can" onclick="deleteNoteConnect(${t})"></i><i class="fa-solid fa-expand" onclick="toggleFullscreen(${t})"></i></div></div>`,notesContainer.insertAdjacentHTML("beforeend",d)})})}function toggleFullscreen(e){let t=document.querySelector("#note"+e),r=document.querySelector(".darken");t.classList.toggle("fullscreen"),r.classList.toggle("show")}function updateNoteConnect(e,t,r,o,n){let l=document.querySelectorAll(".note");l.forEach(e=>{e.classList.remove("fullscreen")}),document.querySelector(".darken").classList.remove("show"),isUpdate=!0,document.querySelector(".iconConnect").click(),document.querySelector("#idNoteInput").value=e,couleurTagConnect.value=o,titleTagConnect.value=t,descTagConnect.value=r.replaceAll("<br /><br />","\n\n").replaceAll("<br />","\n"),0==n?document.getElementById("checkHidden").checked=!1:document.getElementById("checkHidden").checked=!0}function copy(e){let t=e.replaceAll("<br /><br />","\n\n").replaceAll("<br />","\n");navigator.clipboard.writeText(t);let r=document.getElementById("copyNotification");r.classList.add("show"),setTimeout(function(){r.classList.remove("show")},2e3)}function deleteNoteConnect(e){"fr"===localStorage.getItem("lang")?confirm("Voulez-vous vraiment supprimer cette note ?")&&fetch("assets/php/deleteNote.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"noteId="+e}).then(e=>{if(e.ok){document.querySelectorAll(".note").forEach(e=>{e.remove()}),document.querySelector(".darken").classList.remove("show"),showNotesConnect();return}alert("Une erreur est survenue...")}):confirm("Do you really want to delete this note?")&&fetch("assets/php/deleteNote.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"noteId="+e}).then(e=>{if(e.ok){document.querySelectorAll(".note").forEach(e=>{e.remove()}),showNotesConnect(),document.querySelector(".darken").classList.remove("show");return}alert("An error occurred...")})}function deleteAccount(){fetch("assets/php/deleteAccount.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>{if(200===e.status)location.reload();else{if("fr"===localStorage.getItem("lang")){alert("Une erreur est survenue lors de la suppression de votre compte...");return}alert("An error occurred while deleting your account...");return}}).catch(()=>{if("fr"===localStorage.getItem("lang")){alert("Une erreur est survenue lors de la suppression de votre compte...");return}alert("An error occurred while deleting your account...")})}document.querySelectorAll(".iconConnect").forEach(e=>{e.addEventListener("click",()=>{popupBoxConnect.classList.add("show"),document.querySelector("#titleConnect").focus()}),e.addEventListener("keydown",e=>{"Enter"===e.key&&(popupBoxConnect.classList.add("show"),document.querySelector("#titleConnect").focus())})}),document.querySelectorAll(".sedeconnecter").forEach(e=>{e.addEventListener("click",()=>{fetch("assets/php/logout.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>{200===e.status&&location.reload()})}),e.addEventListener("keydown",e=>{"Enter"===e.key&&fetch("assets/php/logout.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>{200===e.status&&location.reload()})})}),document.querySelectorAll(".gestionCompte").forEach(e=>{e.addEventListener("click",()=>{popupBoxGestion.classList.add("show")}),e.addEventListener("keydown",e=>{"Enter"===e.key&&popupBoxGestion.classList.add("show")})}),document.querySelectorAll(".supprimerCompte").forEach(e=>{e.addEventListener("click",()=>{"fr"===localStorage.getItem("lang")?confirm("Voulez-vous vraiment supprimer votre compte ainsi que toutes vos notes enregistr\xe9es dans le cloud ? Votre nom d'utilisateur redeviendra disponible pour les autres utilisateurs.")&&deleteAccount():confirm("Do you really want to delete your account and all your notes saved in the cloud? Your username will become available to other users again.")&&deleteAccount()}),e.addEventListener("keydown",e=>{"Enter"===e.key&&("fr"===localStorage.getItem("lang")?confirm("Voulez-vous vraiment supprimer votre compte ainsi que toutes vos notes enregistr\xe9es dans le cloud ? Votre nom d'utilisateur redeviendra disponible pour les autres utilisateurs.")&&deleteAccount():confirm("Do you really want to delete your account and all your notes saved in the cloud? Your username will become available to other users again.")&&deleteAccount())})}),document.querySelector("#tri").addEventListener("change",()=>{fetch("assets/php/sort.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"tri="+document.querySelector("#tri").value}).then(e=>{if(e.ok){document.querySelectorAll(".note").forEach(e=>{e.remove()}),showNotesConnect();return}alert("Une erreur est survenue...")})}),document.querySelector("#submitNoteConnect").addEventListener("click",()=>{let e=document.querySelector("#titleConnect").value,t=document.querySelector("#descConnect").value,r=encodeURIComponent(e.replaceAll(/'/g,"‘").replaceAll(/\\/g,"/")),o=encodeURIComponent(t.replaceAll(/'/g,"‘").replaceAll(/\\/g,"/")),n=encodeURIComponent(document.querySelector("#couleurConnect").value.replaceAll(/'/g,"‘").replaceAll(/\\/g,"/")),l=new Date().toISOString().slice(0,19).replace("T"," "),s=document.getElementById("checkHidden"),a;a=s.checked?1:0;let c=isUpdate?"assets/php/updateNote.php":"assets/php/formAddNote.php",i=isUpdate?`noteId=${document.querySelector("#idNoteInput").value}&title=${r}&filterDesc=${o}&couleur=${n}&date=${l}&hidden=${a}`:`titleConnect=${r}&descriptionConnect=${o}&couleurConnect=${n}&date=${l}&hidden=${a}`;console.log(l),e&&!(t.length>2e3)&&fetch(c,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i}).then(e=>{if(200===e.status){document.querySelectorAll(".note").forEach(e=>{e.remove()}),showNotesConnect(),isUpdate=!1,popupBoxConnect.classList.remove("show"),document.querySelectorAll("form").forEach(e=>e.reset());return}if("fr"===localStorage.getItem("lang")){alert("Une erreur est survenue...");return}alert("An error occurred...")}).catch(()=>{if("fr"===localStorage.getItem("lang")){alert("Une erreur est survenue...");return}alert("An error occurred...")})}),document.querySelector("#submitChangeMDP").addEventListener("click",()=>{let e=document.querySelector("#mdpModifNew").value,t=document.querySelector("#mdpModifNewValid").value;if(!e||!t){if("fr"===localStorage.getItem("lang")){alert("Un ou plusieurs champs sont vides...");return}alert("One or more fields are empty...");return}if(e.length<6){if("fr"===localStorage.getItem("lang")){alert("Mot de passe trop faible (<6)...");return}alert("Password too weak (<6)...");return}if(/^[0-9]+$/.test(e)){if("fr"===localStorage.getItem("lang")){alert("Mot de passe trop faible (que des chiffres)...");return}alert("Password too weak (only numbers)...");return}if(/^[a-zA-Z]+$/.test(e)){if("fr"===localStorage.getItem("lang")){alert("Mot de passe trop faible (que des lettres)...");return}alert("Password too weak (only letters)...");return}if(e!==t){if("fr"===localStorage.getItem("lang")){alert("Les mots de passe ne correspondent pas...");return}alert("Passwords do not match...");return}let r=encodeURIComponent(e);fetch("assets/php/formChangeMDP.php",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"mdpNew="+r}).then(e=>{if(200===e.status){"fr"===localStorage.getItem("lang")?alert("Mot de passe modifi\xe9 !"):alert("Password changed !"),popupBoxGestion.classList.remove("show"),document.querySelectorAll("form").forEach(e=>e.reset());return}if("fr"===localStorage.getItem("lang")){alert("Une erreur est survenue...");return}alert("An error occurred...")}).catch(()=>{if("fr"===localStorage.getItem("lang")){alert("Une erreur est survenue...");return}alert("An error occurred...")})}),document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",e=>{e.preventDefault()})}),document.querySelectorAll("header i").forEach(e=>{e.addEventListener("click",()=>{isUpdate=!1,document.querySelectorAll("form").forEach(e=>e.reset()),popupBoxConnect.classList.remove("show"),popupBoxGestion.classList.remove("show"),document.querySelector(".darken").classList.remove("show")}),e.addEventListener("keydown",e=>{"Enter"===e.key&&(isUpdate=!1,document.querySelectorAll("form").forEach(e=>e.reset()),popupBoxConnect.classList.remove("show"),popupBoxGestion.classList.remove("show"),document.querySelector(".darken").classList.remove("show"))})}),document.querySelector("#search-input").addEventListener("keyup",()=>{let e=document.querySelector("#search-input").value.trim().toLowerCase();document.querySelectorAll(".note").forEach(t=>{let r=t.querySelector(".note p").innerText.toLowerCase();r.includes(e)?t.style.display="flex":t.style.display="none"})}),document.addEventListener("keydown",e=>{e.ctrlKey&&"k"===e.key&&(e.preventDefault(),document.querySelector("#search-input").focus())}),document.querySelector(".lang").addEventListener("click",()=>{if("en"===localStorage.getItem("lang")){localStorage.setItem("lang","fr"),window.open("./","_self");return}localStorage.setItem("lang","en"),window.open("./en.php","_self")}),document.querySelector(".lang").addEventListener("keydown",e=>{if("Enter"===e.key){if("en"===localStorage.getItem("lang")){localStorage.setItem("lang","fr"),window.open("./","_self");return}localStorage.setItem("lang","en"),window.open("./en.php","_self");return}}),document.addEventListener("DOMContentLoaded",()=>{showNotesConnect(),"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js")});
